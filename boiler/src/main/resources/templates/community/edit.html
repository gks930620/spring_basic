<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œê¸€ ìˆ˜ì • - ì»¤ë®¤ë‹ˆí‹°</title>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Quill.js CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

    <th:block th:replace="~{layout/header :: headerStyle}"></th:block>
    <th:block th:replace="~{layout/footer :: footerStyle}"></th:block>

    <style>
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .page-header h1 {
            font-size: 28px;
            font-weight: 500;
            color: #212121;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .page-header .material-icons {
            font-size: 32px;
            color: #6200ea;
        }

        .write-form {
            background: white;
            border-radius: 8px;
            padding: 32px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #424242;
            margin-bottom: 8px;
        }

        .form-label.required::after {
            content: ' *';
            color: #d32f2f;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
            font-family: 'Roboto', sans-serif;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            border-color: #6200ea;
        }

        .form-help {
            font-size: 12px;
            color: #757575;
            margin-top: 6px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 32px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 4px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background-color: #6200ea;
            color: white;
            box-shadow: 0 2px 4px rgba(98, 0, 234, 0.3);
        }

        .btn-primary:hover {
            background-color: #5000ca;
            box-shadow: 0 4px 8px rgba(98, 0, 234, 0.4);
        }

        .btn-secondary {
            background-color: #f5f5f5;
            color: #424242;
        }

        .btn-secondary:hover {
            background-color: #e0e0e0;
        }

        .btn .material-icons {
            font-size: 18px;
        }

        /* Quill ì—ë””í„° ê³ ì • í¬ê¸° ë° ìŠ¤í¬ë¡¤ */
        #editor {
            height: 400px;
        }

        .ql-container {
            height: calc(100% - 42px);
            overflow-y: auto;
        }

        .ql-editor {
            min-height: 100%;
        }

        /* ë¡œë”© ìƒíƒœ */
        #loadingState {
            text-align: center;
            padding: 60px 20px;
            color: #757575;
        }

        /* ì²¨ë¶€íŒŒì¼ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .file-upload-area {
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-upload-area:hover {
            border-color: #6200ea;
            background-color: #f5f5f5;
        }

        .file-upload-area .material-icons {
            font-size: 36px;
            color: #9e9e9e;
            margin-bottom: 8px;
        }

        .file-upload-area p {
            font-size: 14px;
            color: #757575;
            margin: 4px 0;
        }

        .file-input {
            display: none;
        }

        .uploaded-files {
            margin-top: 16px;
        }

        .uploaded-file {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background-color: #f5f5f5;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .uploaded-file-info {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .uploaded-file-info .material-icons {
            color: #757575;
        }

        .remove-file-btn {
            background: none;
            border: none;
            color: #d32f2f;
            cursor: pointer;
            padding: 4px;
        }

        .remove-file-btn .material-icons {
            font-size: 20px;
        }

        .existing-file {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background-color: #e3f2fd;
            border-radius: 4px;
            margin-bottom: 8px;
            border-left: 3px solid #2196f3;
        }

        .existing-file .uploaded-file-info {
            color: #1565c0;
        }

        .file-deleted {
            opacity: 0.5;
            text-decoration: line-through;
        }
    </style>
</head>
<body>
    <th:block th:replace="~{layout/header :: header}"></th:block>

    <main class="main-content">
        <!-- ë¡œë”© ìƒíƒœ -->
        <div id="loadingState">
            <div style="font-size: 14px;">ë¡œë”© ì¤‘...</div>
        </div>

        <!-- ìˆ˜ì • í¼ -->
        <div id="editForm" style="display: none;">
            <div class="page-header">
                <h1>
                    <span class="material-icons">edit</span>
                    ê²Œì‹œê¸€ ìˆ˜ì •
                </h1>
            </div>

            <form class="write-form" onsubmit="return handleSubmit(event)">
                <div class="form-group">
                    <label class="form-label required" for="title">ì œëª©</label>
                    <input type="text" class="form-input" id="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required maxlength="200">
                </div>

                <div class="form-group">
                    <label class="form-label required">ë‚´ìš©</label>
                    <div id="editor" style="height: 400px; background: white;"></div>
                    <div class="form-help">ìµœì†Œ 5ì ì´ìƒ ì‘ì„±í•´ì£¼ì„¸ìš”.</div>
                </div>

                <div class="form-group">
                    <label class="form-label">ì²¨ë¶€íŒŒì¼ ê´€ë¦¬</label>

                    <!-- ê¸°ì¡´ ì²¨ë¶€íŒŒì¼ -->
                    <div id="existingFiles" style="margin-bottom: 16px;"></div>

                    <!-- ìƒˆ íŒŒì¼ ì¶”ê°€ -->
                    <div class="file-upload-area" onclick="document.getElementById('fileInput').click()">
                        <span class="material-icons">attach_file</span>
                        <p>í´ë¦­í•˜ì—¬ íŒŒì¼ì„ ì¶”ê°€í•˜ì„¸ìš”</p>
                        <p style="font-size: 12px; margin-top: 8px;">ëª¨ë“  íŒŒì¼ í˜•ì‹ ê°€ëŠ¥ (ì´ë¯¸ì§€, PDF, ë¬¸ì„œ ë“±)</p>
                    </div>
                    <input type="file" id="fileInput" class="file-input" multiple onchange="handleFileSelect(event)">
                    <div class="uploaded-files" id="newFiles"></div>
                </div>

                <div class="form-actions">
                    <a href="#" onclick="goBack()" class="btn btn-secondary">
                        <span class="material-icons">close</span>
                        ì·¨ì†Œ
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <span class="material-icons">check</span>
                        ìˆ˜ì • ì™„ë£Œ
                    </button>
                </div>
            </form>
        </div>
    </main>

    <th:block th:replace="~{layout/footer :: footer}"></th:block>
    <th:block th:replace="~{layout/header :: headerScript}"></th:block>

    <!-- Quill.js Script -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script>
        let quill;
        let currentCommunityId = null;
        let existingFiles = []; // ê¸°ì¡´ ì²¨ë¶€íŒŒì¼ ëª©ë¡
        let newFiles = []; // ìƒˆë¡œ ì¶”ê°€í•  íŒŒì¼ ëª©ë¡
        let deletedFileIds = []; // ì‚­ì œí•  íŒŒì¼ ID ëª©ë¡

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        document.addEventListener('DOMContentLoaded', () => {
            // URLì—ì„œ ê²Œì‹œê¸€ ID ì¶”ì¶œ
            const urlParams = new URLSearchParams(window.location.search);
            currentCommunityId = urlParams.get('id');

            if (!currentCommunityId) {
                alert('ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.');
                location.href = '/community';
                return;
            }

            checkLoginAndLoadData();
        });

        // ë¡œê·¸ì¸ í™•ì¸ ë° ë°ì´í„° ë¡œë“œ
        function checkLoginAndLoadData() {
            authFetch('/api/my/info')
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Not logged in');
                })
                .then(userInfo => {
                    console.log('âœ… ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸');
                    initQuillEditor();
                    loadCommunityData();
                })
                .catch(err => {
                    console.log('âŒ ë¹„ë¡œê·¸ì¸ ìƒíƒœ');
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    window.location.href = '/login';
                });
        }

        // Quill ì—ë””í„° ì´ˆê¸°í™”
        function initQuillEditor() {
            quill = new Quill('#editor', {
                theme: 'snow',
                placeholder: 'ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...',
                modules: {
                    toolbar: {
                        container: [
                            [{ 'header': [1, 2, 3, false] }],
                            ['bold', 'italic', 'underline', 'strike'],
                            ['blockquote', 'code-block'],
                            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                            [{ 'color': [] }, { 'background': [] }],
                            ['link', 'image'],
                            ['clean']
                        ],
                        handlers: {
                            image: imageHandler
                        }
                    }
                }
            });
        }

        // ì—ë””í„° ë‚´ ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬
        function imageHandler() {
            const input = document.createElement('input');
            input.setAttribute('type', 'file');
            input.setAttribute('accept', 'image/*');
            input.click();

            input.onchange = async () => {
                const file = input.files[0];
                if (!file) return;

                if (!file.type.startsWith('image/')) {
                    alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    return;
                }

                if (file.size > 10 * 1024 * 1024) {
                    alert('íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤!\n\nìµœëŒ€ 10MBê¹Œì§€ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.\ní˜„ì¬ íŒŒì¼ í¬ê¸°: ' + (file.size / 1024 / 1024).toFixed(2) + 'MB');
                    return;
                }

                try {
                    const formData = new FormData();
                    formData.append('files', file);
                    formData.append('refId', 0);
                    formData.append('refType', 'COMMUNITY');
                    formData.append('usage', 'IMAGES');

                    const response = await authFetch('/api/files/upload', {
                        method: 'POST',
                        credentials: 'include',
                        body: formData
                    });

                    if (!response.ok) {
                        if (response.status === 413) {
                            throw new Error('íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤! ìµœëŒ€ 10MBê¹Œì§€ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                        }
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.message || 'ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨');
                    }

                    const result = await response.json();
                    // ApiResponse êµ¬ì¡°: { data: [...], message: "..." }
                    const uploadedUrls = result.data || result;
                    const imageUrl = Array.isArray(uploadedUrls) ? uploadedUrls[0] : uploadedUrls;

                    const range = quill.getSelection(true);
                    const index = range ? range.index : quill.getLength();
                    quill.insertEmbed(index, 'image', imageUrl);
                    quill.setSelection(index + 1);

                    console.log('âœ… ì—ë””í„° ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„±ê³µ:', imageUrl);

                } catch (error) {
                    console.error('âŒ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
                    alert(error.message || 'ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            };
        }

        // ê¸°ì¡´ ì²¨ë¶€íŒŒì¼ í‘œì‹œ
        function displayExistingFiles() {
            const container = document.getElementById('existingFiles');
            container.innerHTML = '';

            if (existingFiles.length === 0) {
                return;
            }

            existingFiles.forEach(file => {
                const isDeleted = deletedFileIds.includes(file.fileId);
                const fileDiv = document.createElement('div');
                fileDiv.className = isDeleted ? 'existing-file file-deleted' : 'existing-file';
                fileDiv.id = `existing-file-${file.fileId}`;

                let icon = 'insert_drive_file';
                const fileName = file.originalFileName.toLowerCase();
                if (fileName.match(/\.(jpg|jpeg|png|gif|bmp)$/)) icon = 'image';
                else if (fileName.match(/\.pdf$/)) icon = 'picture_as_pdf';
                else if (fileName.match(/\.(doc|docx)$/)) icon = 'description';
                else if (fileName.match(/\.(xls|xlsx)$/)) icon = 'table_chart';

                fileDiv.innerHTML = `
                    <div class="uploaded-file-info">
                        <span class="material-icons">${icon}</span>
                        <span>${file.originalFileName} (${formatFileSize(file.fileSize)}) ${isDeleted ? '- ì‚­ì œ ì˜ˆì •' : ''}</span>
                    </div>
                    <button type="button" class="remove-file-btn" onclick="toggleDeleteFile(${file.fileId})" ${isDeleted ? 'style="color: #4caf50;"' : ''}>
                        <span class="material-icons">${isDeleted ? 'undo' : 'delete'}</span>
                    </button>
                `;
                container.appendChild(fileDiv);
            });
        }

        // ê¸°ì¡´ íŒŒì¼ ì‚­ì œ í† ê¸€
        function toggleDeleteFile(fileId) {
            const index = deletedFileIds.indexOf(fileId);
            if (index > -1) {
                // ì‚­ì œ ì·¨ì†Œ
                deletedFileIds.splice(index, 1);
            } else {
                // ì‚­ì œ í‘œì‹œ
                deletedFileIds.push(fileId);
            }
            displayExistingFiles();
        }

        // ìƒˆ íŒŒì¼ ì„ íƒ
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            newFiles = [...newFiles, ...files];
            displayNewFiles();
            event.target.value = ''; // ê°™ì€ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡
        }

        // ìƒˆ íŒŒì¼ ëª©ë¡ í‘œì‹œ
        function displayNewFiles() {
            const container = document.getElementById('newFiles');
            container.innerHTML = '';

            if (newFiles.length === 0) return;

            newFiles.forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'uploaded-file';

                let icon = 'insert_drive_file';
                if (file.type.startsWith('image/')) icon = 'image';
                else if (file.type.includes('pdf')) icon = 'picture_as_pdf';
                else if (file.type.includes('word') || file.type.includes('document')) icon = 'description';
                else if (file.type.includes('excel') || file.type.includes('sheet')) icon = 'table_chart';

                fileDiv.innerHTML = `
                    <div class="uploaded-file-info">
                        <span class="material-icons">${icon}</span>
                        <span>${file.name} (${formatFileSize(file.size)})</span>
                    </div>
                    <button type="button" class="remove-file-btn" onclick="removeNewFile(${index})">
                        <span class="material-icons">close</span>
                    </button>
                `;
                container.appendChild(fileDiv);
            });
        }

        // ìƒˆ íŒŒì¼ ì œê±°
        function removeNewFile(index) {
            newFiles.splice(index, 1);
            displayNewFiles();
        }

        // íŒŒì¼ í¬ê¸° í¬ë§·
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        // ê¸°ì¡´ ì²¨ë¶€íŒŒì¼ ë¡œë“œ (ë³„ë„ API)
        async function loadExistingFiles() {
            try {
                const response = await fetch(`/api/files/detail?refId=${currentCommunityId}&refType=COMMUNITY&usage=ATTACHMENT`);

                if (!response.ok) {
                    console.log('ì²¨ë¶€íŒŒì¼ ì—†ìŒ ë˜ëŠ” ì¡°íšŒ ì‹¤íŒ¨');
                    existingFiles = [];
                    return;
                }

                const result = await response.json();
                const files = result.data || [];
                console.log('âœ… ê¸°ì¡´ ì²¨ë¶€íŒŒì¼ ë°ì´í„°:', files);

                // API ì‘ë‹µì„ displayExistingFilesì—ì„œ ì‚¬ìš©í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                existingFiles = files.map(file => ({
                    fileId: file.fileId,
                    originalFileName: file.originalFileName,
                    fileSize: file.fileSize,
                    downloadUrl: file.downloadUrl
                }));

                displayExistingFiles();
            } catch (error) {
                console.error('âŒ ì²¨ë¶€íŒŒì¼ ë¡œë“œ ì—ëŸ¬:', error);
                existingFiles = [];
            }
        }

        // ê²Œì‹œê¸€ ë°ì´í„° ë¡œë“œ
        async function loadCommunityData() {
            try {
                const response = await fetch(`/api/community/${currentCommunityId}`);

                if (!response.ok) {
                    throw new Error('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

                const result = await response.json();
                const data = result.data; // ApiResponseì—ì„œ data ì¶”ì¶œ
                console.log('âœ… ê²Œì‹œê¸€ ë°ì´í„°:', data);

                // ì œëª© ì„¤ì •
                document.getElementById('title').value = data.title;

                // ë‚´ìš© ì„¤ì • (Quill ì—ë””í„°ì—)
                quill.root.innerHTML = data.content;

                // ê¸°ì¡´ ì²¨ë¶€íŒŒì¼ ë³„ë„ ë¡œë“œ
                await loadExistingFiles();

                // ë¡œë”© ìˆ¨ê¸°ê³  í¼ í‘œì‹œ
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('editForm').style.display = 'block';

            } catch (error) {
                console.error('âŒ ì—ëŸ¬ ë°œìƒ:', error);
                alert('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                location.href = '/community';
            }
        }

        // í¼ ì œì¶œ
        async function handleSubmit(event) {
            event.preventDefault();

            const title = document.getElementById('title').value.trim();
            const content = quill.root.innerHTML.trim();
            const textContent = quill.getText().trim();

            // ìœ íš¨ì„± ê²€ì‚¬
            if (!title) {
                alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }

            if (!textContent || textContent.length < 5) {
                alert('ë‚´ìš©ì„ 5ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }

            try {
                console.log('ğŸ“ ê²Œì‹œê¸€ ìˆ˜ì • ì‹œì‘...');

                const updateData = {
                    title: title,
                    content: content
                };

                const response = await authFetch(`/api/community/${currentCommunityId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(updateData)
                });

                console.log('ğŸ“¡ ì‘ë‹µ ìƒíƒœ:', response.status);

                if (!response.ok) {
                    const error = await handleApiError(response);
                    console.error('âŒ ê²Œì‹œê¸€ ìˆ˜ì • ì‹¤íŒ¨:', error);
                    showApiError(error);
                    return false;
                }

                console.log('âœ… ê²Œì‹œê¸€ ìˆ˜ì • ì„±ê³µ!');

                // 2. ê¸°ì¡´ íŒŒì¼ ì‚­ì œ ì²˜ë¦¬
                if (deletedFileIds.length > 0) {
                    console.log(`ğŸ—‘ï¸ íŒŒì¼ ${deletedFileIds.length}ê°œ ì‚­ì œ ì¤‘...`);
                    for (const fileId of deletedFileIds) {
                        try {
                            const deleteResponse = await authFetch(`/api/files/${fileId}`, {
                                method: 'DELETE',
                                credentials: 'include'
                            });
                            if (deleteResponse.ok) {
                                console.log(`âœ… íŒŒì¼ ì‚­ì œ ì„±ê³µ: ${fileId}`);
                            }
                        } catch (error) {
                            console.warn(`âš ï¸ íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨: ${fileId}`, error);
                        }
                    }
                }

                // 3. ìƒˆ íŒŒì¼ ì—…ë¡œë“œ
                if (newFiles.length > 0) {
                    console.log(`ğŸ“ ìƒˆ íŒŒì¼ ${newFiles.length}ê°œ ì—…ë¡œë“œ ì¤‘...`);

                    const formData = new FormData();
                    newFiles.forEach(file => {
                        formData.append('files', file);
                    });
                    formData.append('refId', currentCommunityId);
                    formData.append('refType', 'COMMUNITY');
                    formData.append('usage', 'ATTACHMENT');

                    try {
                        const fileResponse = await authFetch('/api/files/upload', {
                            method: 'POST',
                            credentials: 'include',
                            body: formData
                        });

                        if (fileResponse.ok) {
                            console.log('âœ… ìƒˆ íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ!');
                        } else {
                            console.warn('âš ï¸ íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨');
                        }
                    } catch (error) {
                        console.warn('âš ï¸ íŒŒì¼ ì—…ë¡œë“œ ì—ëŸ¬:', error);
                    }
                }

                alert('ê²Œì‹œê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = `/community/detail?id=${currentCommunityId}`;

            } catch (error) {
                console.error('âŒ ì—ëŸ¬ ë°œìƒ:', error);
                alert(error.message || 'ê²Œì‹œê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }

            return false;
        }

        // ë’¤ë¡œê°€ê¸°
        function goBack() {
            if (confirm('ìˆ˜ì •ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                window.location.href = `/community/detail?id=${currentCommunityId}`;
            }
        }
    </script>
</body>
</html>

