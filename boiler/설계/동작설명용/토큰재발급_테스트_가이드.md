# í† í° ì¬ë°œê¸‰ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ
## 1. Access Token ë§Œë£Œ ì‹œê°„ ë³€ê²½ (í…ŒìŠ¤íŠ¸ìš©)
`src/main/resources/application.yml` ìˆ˜ì •:
```yaml
jwt:
  secret: ${JWT_SECRET_KEY}
  expiration_access: 10000    # ğŸ‘ˆ 10ì´ˆë¡œ ë³€ê²½ (í…ŒìŠ¤íŠ¸ìš©)
  expiration_refresh: 14400000  # 4ì‹œê°„ (ê·¸ëŒ€ë¡œ)
```
> âš ï¸ í…ŒìŠ¤íŠ¸ í›„ ì›ë˜ ê°’(1800000 = 30ë¶„)ìœ¼ë¡œ ë³µêµ¬í•˜ì„¸ìš”!
---
## 2. ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ ìˆœì„œ
### ì¤€ë¹„
1. ì„œë²„ ì¬ì‹œì‘ (ì„¤ì • ë³€ê²½ ì ìš©)
2. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬(F12) â†’ Console íƒ­ ì—´ê¸°
### í…ŒìŠ¤íŠ¸ ë‹¨ê³„
#### Step 1: ë¡œê·¸ì¸
1. `/login` í˜ì´ì§€ì—ì„œ ë¡œê·¸ì¸
2. ê°œë°œì ë„êµ¬ â†’ Application â†’ Cookies í™•ì¸
   - `access_token` ì¿ í‚¤ ì¡´ì¬ âœ…
   - `refresh_token` ì¿ í‚¤ ì¡´ì¬ âœ…
#### Step 2: 10ì´ˆ ëŒ€ê¸°
- Access Tokenì´ ë§Œë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
#### Step 3: ì¸ì¦ í•„ìš”í•œ API ìš”ì²­
- ì˜ˆ: `/community/write` í˜ì´ì§€ì—ì„œ ê²Œì‹œê¸€ ì‘ì„±
- ë˜ëŠ” `/mypage` í˜ì´ì§€ ì ‘ì†
#### Step 4: ì½˜ì†” ë¡œê·¸ í™•ì¸
ì„±ê³µ ì‹œ ë‹¤ìŒ ë¡œê·¸ê°€ í‘œì‹œë¨:
```
ğŸ”‘ Access Token ë§Œë£Œ - ì¬ë°œê¸‰ ì‹œë„
ğŸ”„ í† í° ì¬ë°œê¸‰ ì‹œë„...
âœ… í† í° ì¬ë°œê¸‰ ì„±ê³µ
ğŸ”„ ì›ë˜ ìš”ì²­ ì¬ì‹œë„: /api/community
```
#### Step 5: ì¿ í‚¤ í™•ì¸
- Application â†’ Cookiesì—ì„œ `access_token`, `refresh_token` ê°’ì´ ë³€ê²½ë¨ âœ…
---

## 3. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
### âœ… ì‹œë‚˜ë¦¬ì˜¤ 1: Access Token ë§Œë£Œ â†’ ìë™ ì¬ë°œê¸‰ â†’ ì›ë˜ ìš”ì²­ ì„±ê³µ
| ë‹¨ê³„ | ë™ì‘ | ê²°ê³¼ |
|------|------|------|
| 1 | ë¡œê·¸ì¸ | access_token, refresh_token ì¿ í‚¤ ì €ì¥ |
| 2 | 10ì´ˆ ëŒ€ê¸° | access_token ë§Œë£Œ |
| 3 | ê²Œì‹œê¸€ ì‘ì„± ì‹œë„ | 401 + TOKEN_EXPIRED |
| 4 | ìë™ìœ¼ë¡œ /api/refresh/reissue í˜¸ì¶œ | ìƒˆ í† í° ë°œê¸‰ |
| 5 | ì›ë˜ ìš”ì²­ ì¬ì‹œë„ | ê²Œì‹œê¸€ ì‘ì„± ì„±ê³µ âœ… |
### âœ… ì‹œë‚˜ë¦¬ì˜¤ 2: Refresh Tokenë„ ë§Œë£Œ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
| ë‹¨ê³„ | ë™ì‘ | ê²°ê³¼ |
|------|------|------|
| 1 | access_token ë§Œë£Œ ìƒíƒœ | - |
| 2 | refresh_tokenë„ ë§Œë£Œë¨ | - |
| 3 | API ìš”ì²­ | 401 + TOKEN_EXPIRED |
| 4 | /api/refresh/reissue í˜¸ì¶œ | 401 + TOKEN_EXPIRED (refreshë„ ë§Œë£Œ) |
| 5 | ì¬ë°œê¸‰ ì‹¤íŒ¨ | alert â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™ |

### âœ… ì‹œë‚˜ë¦¬ì˜¤ 3: ë¡œê·¸ì•„ì›ƒ í›„ â†’ í† í° íê¸°ë¨

| ë‹¨ê³„ | ë™ì‘ | ê²°ê³¼ |
|------|------|------|
| 1 | ë¡œê·¸ì•„ì›ƒ | DBì—ì„œ refresh_token ì‚­ì œ, ì¿ í‚¤ ì‚­ì œ |
| 2 | ì¸ì¦ í•„ìš” API ìš”ì²­ | 401 + NOT_AUTHENTICATED |
| 3 | - | ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™ |

---

## 4. ê´€ë ¨ ì½”ë“œ ìœ„ì¹˜

| êµ¬ë¶„ | íŒŒì¼ |
|------|------|
| ì„œë²„: í† í° ì¬ë°œê¸‰ | `RefreshController.java` |
| í´ë¼ì´ì–¸íŠ¸: ìë™ ì¬ë°œê¸‰ | `layout/header.html` â†’ `authFetch()`, `callApi()` |
| í† í° ë§Œë£Œ ê°ì§€ | `SecurityConfig.java` â†’ `authenticationEntryPoint` |
| í† í° ê²€ì¦ í•„í„° | `JwtAccessTokenCheckAndSaveUserInfoFilter.java` |

---

## 5. ë™ì‘ íë¦„ë„

```
[ë¸Œë¼ìš°ì €]                              [ì„œë²„]
    |                                      |
    |-- POST /api/community (ê¸€ ì‘ì„±) ---->|
    |                                      |
    |<-- 401 + TOKEN_EXPIRED --------------|  (access_token ë§Œë£Œ)
    |                                      |
    |-- POST /api/refresh/reissue -------->|  (refresh_token ì¿ í‚¤ ìë™ ì „ì†¡)
    |                                      |
    |<-- 200 + Set-Cookie (ìƒˆ í† í°) -------|
    |                                      |
    |-- POST /api/community (ì¬ì‹œë„) ----->|  (ìƒˆ access_token ì¿ í‚¤)
    |                                      |
    |<-- 201 Created (ì„±ê³µ) ---------------|
```

---

## 6. ì„¤ì • ë³µêµ¬

í…ŒìŠ¤íŠ¸ í›„ `application.yml` ì›ë˜ ê°’ìœ¼ë¡œ ë³µêµ¬:

```yaml
jwt:
  expiration_access: 1800000   # 30ë¶„ (ìš´ì˜ìš©)
  expiration_refresh: 14400000  # 4ì‹œê°„
```

