<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Home</title>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>

<div id="content"></div>

<script>
  $(document).ready(function() {
    const token = localStorage.getItem("accessToken");

    if (!token) {
      // ğŸ”¹ ë¡œê·¸ì¸ ì•ˆ ëœ ìƒíƒœ
      $("#content").html(`
        <h2>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h2>
        <button id="goLogin">ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™</button>
      `);

      $("#goLogin").click(function() {
        window.location.href = "/loginPage";
      });
      return;
    }

    // ğŸ”¹ ë¡œê·¸ì¸ ëœ ê²½ìš° â†’ í† í° ìœ íš¨ì„± í™•ì¸
    $.ajax({
      url: "/api/me",
      method: "GET",
      headers: { "Authorization": "Bearer " + token },
      success: function(res) {
        // ğŸ”¸ ë¡œê·¸ì¸ í™•ì¸ ì™„ë£Œ â†’ í™ˆí™”ë©´ì— roomsë¡œ ì´ë™í•˜ëŠ” ë§í¬ í‘œì‹œ
        $("#content").html(`
          <h2>í™˜ì˜í•©ë‹ˆë‹¤, ${res.username || 'ì‚¬ìš©ì'}ë‹˜ ğŸ‘‹</h2>
          <p><a href="/rooms">ğŸ‘‰ ë°© ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™</a></p>
        `);
      },
      error: function() {
        // ğŸ”¸ í† í° ë§Œë£Œ ë˜ëŠ” ì˜¤ë¥˜ â†’ ë‹¤ì‹œ ë¡œê·¸ì¸ ìœ ë„
        $("#content").html(`
          <h2>ì¸ì¦ ì‹¤íŒ¨. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</h2>
          <button id="goLogin">ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™</button>
        `);
        localStorage.removeItem("accessToken");
        localStorage.removeItem("refreshToken");

        $("#goLogin").click(function() {
          window.location.href = "/loginPage";
        });
      }
    });
  });
</script>

</body>
</html>
